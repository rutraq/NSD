unit Unit3;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls;

type
  TForm3 = class(TForm)
    Memo1: TMemo;
    Memo2: TMemo;
    Button1: TButton;
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure FormCreate(Sender: TObject);
    procedure Button1Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;
const
A = 5;
C = 27;
M = 65536;
var
  Form3: TForm3;

var
   TempFile                : file of byte;
   InpF, OutF              : file of word; {файлы на входе и выходе}
   Password, Password1     : string; {переменные для работы с паролями}
   OutputFileName, Exten, InputFileName   : string; {переменные имен файлов}
   I, J, K, tmp            : byte; {переменные кодирования}
   Temp, SCode, TByte, Code: word;
   Position                : LongInt; {переменные данных о процессе}
   NowPos                  : real;
   TPassword               : array [1..255] of word;
   MasByte, Mas, MasEnd, PS: array [1..64] of word; {массивы перестановок}
   T                       : array [0..64] of word;
   DirInfo, DirInfo1       : TSearchRec; {данные о файле}
   Exten1                  : string[3];

implementation

{$R *.dfm}

procedure pass;
var check, check1:boolean;
begin
  check := False;
  check1 := False;
  password := '';
  password1 := '';
    while check1 = False do
      begin
        password := InputBox('P A S S W O R D', 'ENTER PASSWORD:', password);
          if password <> '' then
            begin
              check1 := True;
            end;
      end;
  password1 := InputBox('P A S S W O R D', 'ENTER PASSWORD ONE MORE TIME:', password1);
    while check = False do
      begin
        if (password = password1) and (length(password) <> 0) then
          begin
            check := True;
          end
            else
              begin
                password1 := '';
                password1 := InputBox('P A S S W O R D', 'PASSWORD IS INCORRECT, ENTER AGAIN:', password1);
              end;
      end;
end;

procedure TForm3.Button1Click(Sender: TObject);
begin
  Memo1.Lines.SaveToFile('1.txt');
  InputFileName := '1.txt';
  pass;
  FindFirst(InputFileName, faAnyFile, DirInfo);
    if DirInfo.Size mod 2 = 1 then
      begin
        AssignFile(TempFile, InputFileName);
        reset(TempFile);
          while not EOF(TempFile) do read(TempFile, tmp);
        tmp := 255;
        write(TempFile, tmp);
        closeFile(TempFile);
      end;
  assignFile(InpF, InputFileName);
  reset(InpF);
  assignFile(OutF, InputFileName);
  rewrite(OutF);
  k := 1;
    repeat
      begin
        for i := 1 to 64 do
          if EOF(InpF) then MasByte[i] := 0 else read(InpF, MasByte[i]);
        mas := MasByte;
        T[0] := ord(Password[k]);
          if k < length(password) then inc(k) else k := 1;
          for i := 1 to 64 do
            begin
              code := mas[i];
              T[i] := (A * T[i-1] + C) mod M;
              Code:=T[i] xor Code;
              Mas[i] := Code;
            end;
      end;
    until EOF(InpF);
end;

procedure TForm3.FormClose(Sender: TObject; var Action: TCloseAction);
begin
  Application.Terminate;
end;

procedure TForm3.FormCreate(Sender: TObject);
begin
  Memo1.Clear;
  Memo2.Clear;
end;

end.
